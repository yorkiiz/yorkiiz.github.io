
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>yorkiiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="yorkiiz">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="yorkiiz">
<meta property="og:url" content="https://yorkiiz.github.io/index.html">
<meta property="og:site_name" content="yorkiiz">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="yorkiiz">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="/atom.xml" title="yorkiiz" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/%02.css">
<link rel="stylesheet" href="/.css">

<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="yorkiiz" title="yorkiiz"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="yorkiiz">yorkiiz</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yorkiiz.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/10/27/20211027服务启动错误/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-10-27T13:45:25.379Z" itemprop="datePublished"> Published 2021-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="20211027服务启动错误"><a href="#20211027服务启动错误" class="headerlink" title="20211027服务启动错误"></a>20211027服务启动错误</h3><p>问题：rc.local增加启动脚本错误导致用root用户启动服务导致服务无法启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - user -c &quot;***.sh xxx&quot;</span><br></pre></td></tr></table></figure>

<p>原因：服务将多个配置文件更新成root权限，但由于环境变量在用户目录中，导致服务无法启动，并且部分文件权限已更改</p>
<p>解决：查看启动脚本，调试shell脚本，最终定位到某个配置文件无法读取，原因为权限不够。查找服务目录下所有权限有问题的文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -uid 0</span><br><span class="line">find . -gid 0</span><br></pre></td></tr></table></figure>

<p>修改权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R group:user  /path</span><br></pre></td></tr></table></figure>

<p>重新启动</p>
<p>jps查看java进程</p>
<p>netstat -anp|grep pid查看进程与端口</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/09/24/spring IOC/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-09-23T16:55:56.572Z" itemprop="datePublished"> Published 2021-09-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="spring-IOC"><a href="#spring-IOC" class="headerlink" title="spring IOC"></a>spring IOC</h3><h4 id="核心容器"><a href="#核心容器" class="headerlink" title="核心容器"></a>核心容器</h4><p>1.BeanFactory</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210920174740.png"></p>
<p>工厂的顶层接口，但是只负责生产对象，不负责怎么生产对象。</p>
<p>IOC容器负责具体生产过程。</p>
<p>2.BeanDefinition</p>
<p>bean对象的定义</p>
<p><img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210920180524436.png" alt="image-20210920180524436"></p>
<p>3.BeanDefinitionReader</p>
<p>bean的解析</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210920182031.png"></p>
<h4 id="web-IOC初始化流程"><a href="#web-IOC初始化流程" class="headerlink" title="web IOC初始化流程"></a>web IOC初始化流程</h4><table>
<thead>
<tr>
<th>序号/类名</th>
<th>DispatcherServlet</th>
<th>FrameworkServlet</th>
<th>HttpServletBean</th>
<th>HttpServlet</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td>init</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>initServletBean</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>initWebApplicationContext</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>configureAndRefreshWebApplicationContext</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>refresh</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>onRefresh</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>initStrategies</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="基于xml的IOC容器初始化"><a href="#基于xml的IOC容器初始化" class="headerlink" title="基于xml的IOC容器初始化"></a>基于xml的IOC容器初始化</h3><p>IOC容器的初始化包括beandefinition的resource定位，加载和注册三个基本过程</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210921103448.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">super(parent);   //设置容器资源加载器</span><br><span class="line">this.setConfigLocations(configLocations);//设置bean资源路径定位</span><br><span class="line"> this.refresh();//开始启动</span><br></pre></td></tr></table></figure>





<h4 id="IOC容器的启动"><a href="#IOC容器的启动" class="headerlink" title="IOC容器的启动"></a>IOC容器的启动</h4><p>IOC容器对bean配置资源的载入是从refresh（）函数开始的，refresh是一个模板方法，规定了IOC容器的启动流程，有些逻辑交给子类实现。ClassPathXmlApplicationContext通过调用父类AbstractApplicationContext的refresh方法启动IOC容器对Bean定义的载入过程</p>
<p>作用：IOC容器创建前，如果已经有容器存在，把已经有的容器给销毁，保证refresh之后使用的是新建立起来的IOC容器</p>
<h4 id="容器的创建"><a href="#容器的创建" class="headerlink" title="容器的创建"></a>容器的创建</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AbstractApplicationContext中 obtainFreshBeanFactory方法调用子容器的refreshBeanFactory</span><br><span class="line">实际实现是在AbstractRefreshableApplicationContext中</span><br></pre></td></tr></table></figure>

<p>先销毁，再载入</p>
<h4 id="载入配置路径"><a href="#载入配置路径" class="headerlink" title="载入配置路径"></a>载入配置路径</h4><p>AbstractRefreshableApplicationContext中定义了抽象的loadBeanDefinitions方法，实际实现是其子类AbstractXmlApplicatioContext中对该方法实现，并且调用了loadBeanDefinitions方法载入Bean</p>
<h4 id="分配路径处理策略"><a href="#分配路径处理策略" class="headerlink" title="分配路径处理策略"></a>分配路径处理策略</h4><p>loadBeanDefinitions方法对Bean进行加载</p>
<p>![image-20210921163013437](C:\Users\admin\Desktop\spring IOC\image-20210921163013437.png)</p>
<h4 id="解析配置文件路径"><a href="#解析配置文件路径" class="headerlink" title="解析配置文件路径"></a>解析配置文件路径</h4><p>XmlBeanDefinitionReader通过调用ClassPathXmlApplicatioinContext的父类DefaultResourceLoader的getResource方法获取加载的资源</p>
<h4 id="开始读取配置内容"><a href="#开始读取配置内容" class="headerlink" title="开始读取配置内容"></a>开始读取配置内容</h4><p>XmlBeanDefinitionReader里面的loadBeanDefinitions（Resource…）方法代表bean文件的资源定义以后的载入过程，将Bean配置信息转换成Document对象，该过程有documentLoader方法实现</p>
<h4 id="准备文档对象"><a href="#准备文档对象" class="headerlink" title="准备文档对象"></a>准备文档对象</h4><p>DocumentLoader将Bean配置资源转换成Document对象</p>
<h4 id="分配解析策略"><a href="#分配解析策略" class="headerlink" title="分配解析策略"></a>分配解析策略</h4><p>xmlBeanDefinitionReader类中的doLoadBeanDefinition方法从特定的XML文件中实际载入Bean配置资源的方法。</p>
<p>Bean配置资源的载入解析分为以下两个过程：</p>
<p>xml解析器将Bean配置信息转换得到Document对象；</p>
<p>完成xml解析后，按照spring Bean的定义规则对Document对象进行解析</p>
<h4 id="将配置载入内存"><a href="#将配置载入内存" class="headerlink" title="将配置载入内存"></a>将配置载入内存</h4><p>BeanDefinitionDocumentReader接口通过registerBeanDefinitions方法调用其实现类DefaultBeanDefinitionDocumentReader对Document对象进行解析</p>
<h4 id="载入-lt-bean-gt-元素"><a href="#载入-lt-bean-gt-元素" class="headerlink" title="载入&lt;bean&gt;元素"></a>载入&lt;bean&gt;元素</h4><p>Bean配置信息中的&lt;import&gt;和&lt;alias&gt;元素解析在DefaultBeanDefinitionDocumentReader中已经完成，对Bean配置信息中使用最多的&lt;bean&gt;元素交由BeanDefinitionParserDelegate来解析</p>
<h4 id="载入-lt-property-gt-元素"><a href="#载入-lt-property-gt-元素" class="headerlink" title="载入&lt;property&gt;元素"></a>载入&lt;property&gt;元素</h4><p>BeanDefinitionParserDelegate在解析&lt;Bean&gt;调用parsePropertyElements方法解析&lt;Bean&gt;元素中的&lt;property&gt;属性子元素</p>
<h4 id="载入-lt-property-gt-子元素"><a href="#载入-lt-property-gt-子元素" class="headerlink" title="载入&lt;property&gt;子元素"></a>载入&lt;property&gt;子元素</h4><h4 id="载入-lt-list-gt-子元素"><a href="#载入-lt-list-gt-子元素" class="headerlink" title="载入&lt;list&gt;子元素"></a>载入&lt;list&gt;子元素</h4><h4 id="分配注册策略"><a href="#分配注册策略" class="headerlink" title="分配注册策略"></a>分配注册策略</h4><p>DefaultBeanDefinitionDocumentReader对Bean定义转换的Document对象解析的流程中，在其parseDefaultElement方法中完成对Document对象的解析流程中，封装BeanDefinition的BeanDefinitionHold对象，然后调用BeanDefinitionReaderUtils的registerBeanDefinition方法向IOC容器注册解析的Bean，BeanDefinitionReaderUtils的注册的源码如下</p>
<h4 id="向容器注册"><a href="#向容器注册" class="headerlink" title="向容器注册"></a>向容器注册</h4><h3 id="基于Annotation的IOC初始化"><a href="#基于Annotation的IOC初始化" class="headerlink" title="基于Annotation的IOC初始化"></a>基于Annotation的IOC初始化</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>类级别的注解</p>
<p>类内部的注解</p>
<h4 id="定位扫描Bean路径"><a href="#定位扫描Bean路径" class="headerlink" title="定位扫描Bean路径"></a>定位扫描Bean路径</h4><p>直接将注解Bean注册到容器中</p>
<p>通过扫描指定的包及其包下的所有类</p>
<h4 id="读取Annotation元数据"><a href="#读取Annotation元数据" class="headerlink" title="读取Annotation元数据"></a>读取Annotation元数据</h4><h3 id="IOC时序图"><a href="#IOC时序图" class="headerlink" title="IOC时序图"></a>IOC时序图</h3><p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E6%89%8B%E7%BB%98Spring%20IoC%E8%BF%90%E8%A1%8C%E6%97%B6%E5%BA%8F%E5%9B%BE.jpg"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/09/05/多线程的复习/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-09-05T14:50:29.039Z" itemprop="datePublished"> Published 2021-09-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="多线程的复习"><a href="#多线程的复习" class="headerlink" title="多线程的复习"></a>多线程的复习</h3><h4 id="hashmap与chm"><a href="#hashmap与chm" class="headerlink" title="hashmap与chm"></a>hashmap与chm</h4><p>扩容因子 0.75</p>
<p>数组+链表  或者数组+红黑树</p>
<p>什么时候转红黑树？</p>
<p>1.链表长度大于8的时候</p>
<p>2.数组长度大于64</p>
<p>红黑树在节点小于6时会变成链表</p>
<p>chm</p>
<p>cas、synchronize</p>
<p>1.7链表+数组    头插法-死循环</p>
<p>1.8链表+数组+红黑树 64扩容   尾插法</p>
<p>jdk1.8取消了重复锁，使用synchronize</p>
<h4 id="reentranlock"><a href="#reentranlock" class="headerlink" title="reentranlock"></a>reentranlock</h4><p>1.aqs里面有一个volitale修饰的stat字段，标记有没有抢到锁，如果大于1，那么就有，并且代表重复次数</p>
<p>2.其他获取锁的线程，获取锁失败，那么就会进去aqs里面的一个等待队列</p>
<p>3.假如等待队列后，自旋获取锁，如果获取不到锁，进行park</p>
<p>4.如果获取到锁的线程执行完毕，必须手动调用unlock，unlock把state赋值为0，这是所有线程重新来抢占锁</p>
<p>5.对新的</p>
<h4 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h4><p>1.作用，是什么</p>
<p>2.那些数据结构，比如state，node clh队列</p>
<p>3.对外暴露了一些api，reales lock trylock</p>
<p>4.cas操作</p>
<h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h4><p>保证了可见，有序性</p>
<p>dcl需要volatile吗？为什么需要</p>
<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><p>为什么要用线程池？</p>
<p>管理线程，防止无休止的创建</p>
<p>线程池怎么用的，参数怎么配的？</p>
<p>int  corepoolsize      核心线程数</p>
<p>int  maximumpoolsize    最大线程数</p>
<p>long  keepalivetime         时间</p>
<p>TimeUnit  unit                 时间单位</p>
<p>BlockingQueue<Runnable> workQueue      阻塞队列</p>
<p>ThreadFactory threadFactory                 创建线程的工厂</p>
<p>RejectedWxecutionHandler handler         如果都满了，队列满了，最大线程数满了，拒绝策略</p>
<p>1.执行线程。已有线程数小于核心线程数，会通过worker里的thread.start开启线程</p>
<p>2.这个线程会执行run方法，run方法里面自选调用传进来</p>
<p>3.run不为空都会执行第二步，run还会被阻塞队列获取，如果阻塞队列不为空，那么线程一直在执行</p>
<p>4.如果阻塞队列为空，如果有线程需要回收，会根据keepAliveTime与unit来进行poll，到时间就回收，否则take</p>
<p>5.需要回收的条件：1.线程数大于核心线程 2.设置allowCreThreadTimeOut=true</p>
<h4 id="死锁的四大条件"><a href="#死锁的四大条件" class="headerlink" title="死锁的四大条件"></a>死锁的四大条件</h4><p>1.互斥</p>
<p>2.持有等待</p>
<p>3.不可抢占</p>
<p>4.循环等待</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/27/第三次复习/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-27T14:38:24.608Z" itemprop="datePublished"> Published 2021-08-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="第三次复习"><a href="#第三次复习" class="headerlink" title="第三次复习"></a>第三次复习</h3><h3 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h3><p>管理bean</p>
<p>IOC：控制反正，交给spring去管理</p>
<p>aop：动态代理，默认，实现了接口的jdk，否则是cglib，也可以配置</p>
<h4 id="IOC过程"><a href="#IOC过程" class="headerlink" title="IOC过程"></a>IOC过程</h4><p>1.扫描</p>
<p>2.将扫描的结果封装为beandefenition，放到beandefinitionmap</p>
<p>3.实例化bean，调用getBean，封装成beanwrapper</p>
<p>4.applybeanpostprocessorbeforeinitialization</p>
<p>5.invokeinitmethods调用bean初始化方法</p>
<p>6.applybeanpostprocessor</p>
<p>7销毁</p>
<h3 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h3><h4 id="传播机制"><a href="#传播机制" class="headerlink" title="传播机制"></a>传播机制</h4><p>required：</p>
<p>required_new：</p>
<p>nested：</p>
<h4 id="失效的场景"><a href="#失效的场景" class="headerlink" title="失效的场景"></a>失效的场景</h4><p>1.不是public，final</p>
<p>2.数据库不支持</p>
<p>3.没有调用代理类的方法，调用自己的方法</p>
<p>4.可配的异常类型。默认runtime，可以配置其他的</p>
<h3 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h3>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/27/复习第二天/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-26T17:31:43.406Z" itemprop="datePublished"> Published 2021-08-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="复习第二天"><a href="#复习第二天" class="headerlink" title="复习第二天"></a>复习第二天</h3><p>1.mybatis的一二级缓存的区别</p>
<p>一级-sqlsession</p>
<p>二级-xml文件</p>
<h4 id="全链路压测，接口压测"><a href="#全链路压测，接口压测" class="headerlink" title="全链路压测，接口压测"></a>全链路压测，接口压测</h4><p>jmeter</p>
<h4 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h4><p>单例，工厂，建造者，原型</p>
<h4 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h4><p>装饰，桥接，代理，组合</p>
<h4 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h4><p>策略，委派，责任链</p>
<h4 id="饿汉"><a href="#饿汉" class="headerlink" title="饿汉"></a>饿汉</h4><p>类加载的时候初始化，创建对象安全，内存浪费</p>
<h4 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h4><p>不会浪费，怎么保证安全</p>
<p>双重检查锁：外面的性能，里面的安全 dcl</p>
<p>静态内部类：懒加载</p>
<h4 id="注册式"><a href="#注册式" class="headerlink" title="注册式"></a>注册式</h4><p>枚举：饿汉</p>
<p>容器式单例：</p>
<p>反射，序列化，clone</p>
<p>反射：重写私有构造方法</p>
<p>序列化：重写readResoleve，返回单例</p>
<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>mybatis和aop</p>
<p>1.类加载器，接口，invokehandler</p>
<p>2.生产类通过反射并且需要实现被代理类的所有接口</p>
<p>cglib</p>
<p>生产多个fastclass，</p>
<p>asm框架，fastclass机制调用</p>
<p>jdk要有接口，cglib不是接口继承父类</p>
<p>jdk更慢，cglib更快</p>
<p>jdk需要public方法</p>
<h4 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h4><p>1.集群</p>
<p>2.降级</p>
<p>3.拆分服务</p>
<p>4.动态扩容</p>
<p>5.限流</p>
<p>6.熔断</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/27/代理模式/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-26T17:31:40.862Z" itemprop="datePublished"> Published 2021-08-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>代理模式是对对象的功能增强。比如前置通知和后置通知。</p>
<p>代理模式分为两种，静态代理，动态代理；动态代理又分为jdk代理和cglib代理。</p>
<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><p>通常被代理对象实现同一个接口，代理对象通过接口动态构造了被代理对象，并且把被代理对象的接口方法做逐一的增强。</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210826205158.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface Car &#123;</span><br><span class="line"></span><br><span class="line">    void drive();</span><br><span class="line"></span><br><span class="line">    void stop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Benz implements Car &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void drive() &#123;</span><br><span class="line">        System.out.println(&quot;Benz car drive&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        System.out.println(&quot;Benz car stop&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Baoma implements Car &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void drive() &#123;</span><br><span class="line">        System.out.println(&quot;Baoma Car drive&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        System.out.println(&quot;Baoma car stop&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class Driver &#123;</span><br><span class="line">    private Car car;</span><br><span class="line">    public Driver(Car car)&#123;</span><br><span class="line">        this.car = car;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void drive()&#123;</span><br><span class="line">        before();</span><br><span class="line">        car.drive();</span><br><span class="line">        after();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stop()&#123;</span><br><span class="line">        before();</span><br><span class="line">        car.stop();</span><br><span class="line">        after();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;**************&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;--------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Driver driver = new Driver(new Baoma());</span><br><span class="line">        driver.drive();</span><br><span class="line">        driver.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>动态代理分两种，jdk和cglib</p>
<h4 id="jdk代理"><a href="#jdk代理" class="headerlink" title="jdk代理"></a>jdk代理</h4><p>jdk是jdk自带的代理，不需要任何依赖，对象需要实现同一个接口，代理对象需要实现InvocationHandler，依赖倒置原则，减少对代理类的依赖</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210827000052.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class JdkDriver implements InvocationHandler &#123;</span><br><span class="line">    private Car car;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        before();</span><br><span class="line">        Object result = method.invoke(this.car,args);</span><br><span class="line">        after();</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Car getInstance(Car car)&#123;</span><br><span class="line">        this.car = car;</span><br><span class="line">        Class&lt;?&gt; clazz = car.getClass();</span><br><span class="line">        return (Car)Proxy.newProxyInstance(clazz.getClassLoader(),clazz.getInterfaces(),this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;****************&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;-----------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        JdkDriver jdkDriver = new JdkDriver();</span><br><span class="line">        Car car = jdkDriver.getInstance(new Baoma());</span><br><span class="line">        car.drive();</span><br><span class="line">        car.speed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反射代理类，实现InvocationHandler，实现ivoke方法，对类方法进行修饰；提供get方法，return jdk的proxy类的代理生成对象，需要classloader，interfaces，this；</p>
<p>反射原理：动态生成源代码-&gt;输出到磁盘-&gt;编译成.class文件-&gt;加载到jvm中使用</p>
<h4 id="Cglib代理"><a href="#Cglib代理" class="headerlink" title="Cglib代理"></a>Cglib代理</h4><p>不需要实现特定的接口，cglib代理类实现MethodInterceptor，提供intercept和get方法</p>
<p><img src="https://raw.githubusercontent.com/yorkiiz/picture/master/20210827011445.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Car &#123;</span><br><span class="line">    public void buy()&#123;</span><br><span class="line">        System.out.println(&quot;i want to buy a car&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class Mycglibproxy implements MethodInterceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line">        before();</span><br><span class="line">        Object obj = methodProxy.invokeSuper(o,objects);</span><br><span class="line">        after();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Object getInstance(Class&lt;?&gt; clazz)&#123;</span><br><span class="line">        Enhancer enhancer = new Enhancer();</span><br><span class="line">        enhancer.setSuperclass(clazz);</span><br><span class="line">        enhancer.setCallback(this);</span><br><span class="line">        return enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;****************&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;-----------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Car car = (Car) new  Mycglibproxy().getInstance(Car.class);</span><br><span class="line">        car.buy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>1.jdk代理基于反射，cglib使用的是asm框架，fastclass机制</p>
<p>2.jdk一定要有接口，cglib不能实现final类</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/24/redis list/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-23T18:12:53.512Z" itemprop="datePublished"> Published 2021-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="redis-list"><a href="#redis-list" class="headerlink" title="redis list"></a>redis list</h3><p>指令：</p>
<p>flushall 删库跑路</p>
<p>lpush queue c</p>
<p>lpush queue d e</p>
<p>rpush queue f g</p>
<p>lpop queue </p>
<p>rpop queue</p>
<p>lindex queue 0          单个索引获取数据</p>
<p>lrange queue 0 -1     获取所有数据</p>
<p><strong>特点：</strong></p>
<p>数据可以重复</p>
<p>简单的消息队列：</p>
<p>rpush lpop</p>
<p>blpop key1 timeput</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/24/redis hash/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-23T18:12:53.511Z" itemprop="datePublished"> Published 2021-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="redis-hash"><a href="#redis-hash" class="headerlink" title="redis hash"></a>redis hash</h3><h4 id="1-1string来存储多个键值对"><a href="#1-1string来存储多个键值对" class="headerlink" title="1.1string来存储多个键值对"></a>1.1string来存储多个键值对</h4><p>String 里面一个值只能对应一个对象</p>
<p>hash里面一个</p>
<p>利用key为冒号分层的效果，达到目的</p>
<p>set food:meat:beaf  1</p>
<p>set food:meat:pork  2</p>
<p>keys food*</p>
<p>String来存储多个键值对</p>
<p>mset批量set</p>
<p>第一级表名：第二级主键的值：第三级字段的名称   字段的内容</p>
<p>key不同导致不好</p>
<h4 id="hash来存储对个键值对"><a href="#hash来存储对个键值对" class="headerlink" title="hash来存储对个键值对"></a>hash来存储对个键值对</h4><p>hash</p>
<p>key–field–value</p>
<p><strong>好处：</strong></p>
<p>1.节省空间—–不用冒号，用聚集</p>
<p>2.减少命名冲突—用一个key</p>
<p>3.减少资源消耗—不用mget，用hget，只用一个key，不用多个key</p>
<p><strong>坏处：</strong></p>
<p>1.过期只能对key，不能对field</p>
<p>2.bit位</p>
<p>3.每个field 500M，有500 field，hash里面集群只能对key取模导致不能对单个key分布式</p>
<p><strong>指令：</strong></p>
<p>hset h1 f 6</p>
<p>hmset h1 a 1 b 2 c 3 d 4</p>
<p>hget h1 a</p>
<p>hmget h1 a b c d</p>
<p>hkeys h1</p>
<p>hvals h1</p>
<p>hgetall h1</p>
<p>hget exists h1</p>
<p>hdel h1 f</p>
<p>hlen h1</p>
<p>hincrby h1 a 10</p>
<p>hincrby h1 a -10</p>
<p><strong>购物车：</strong></p>
<p>key:用户id</p>
<p>field：商品id</p>
<p>value：商品数量</p>
<p>删除 hdel</p>
<p>全选 hgetall</p>
<p>商品数量 hlen</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/24/springboot自动装配/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-23T18:12:00.700Z" itemprop="datePublished"> Published 2021-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="springboot自动装配"><a href="#springboot自动装配" class="headerlink" title="springboot自动装配"></a>springboot自动装配</h3><h4 id="1-IOC流程"><a href="#1-IOC流程" class="headerlink" title="1.IOC流程"></a>1.IOC流程</h4><p>1.把所有要托管的spring管理的bean拿到，beanDefinition，并且放到beanDefinitionMap</p>
<p>2.bean实例化，进行属性注入</p>
<p>3.初始化Bean，是否实现BeanNameAware</p>
<p>4.是否实现了BeanPostProcessor类，调用postProcessBeforeIn</p>
<p>5.初始化方法</p>
<p>6.是否实现了BeanPostProcessor类，调用postProcessAfterIn。。。。AOP实现</p>
<p>入口在哪里</p>
<p>refresh（）</p>
<p>扫描</p>
<p>1.默认会扫描当前目录及子目录下@Service @Component @Controller @Repository @Bean @Configuration</p>
<p>2.加注解@ComponentScans（{“com.huihui.demo”,”com.huihui.boot”}）,或@Import（ClassB.class）</p>
<p>3.importselector selectimport</p>
<p>4.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication.run---&gt;refreshContext---refresh---this.finishBeanFactoryInitialization(beanFactory)---eanFactory.preInstantiateSingletons()---getBean---doGetBean---createBean---doCreateBean</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void refresh() throws BeansException, IllegalStateException &#123;</span><br><span class="line">        synchronized(this.startupShutdownMonitor) &#123;</span><br><span class="line">            this.prepareRefresh();</span><br><span class="line">            ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();</span><br><span class="line">            this.prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                this.postProcessBeanFactory(beanFactory);</span><br><span class="line">                this.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">                this.registerBeanPostProcessors(beanFactory);</span><br><span class="line">                this.initMessageSource();</span><br><span class="line">                this.initApplicationEventMulticaster();</span><br><span class="line">                this.onRefresh();</span><br><span class="line">                this.registerListeners();</span><br><span class="line">                this.finishBeanFactoryInitialization(beanFactory);//getbean的方法</span><br><span class="line">                this.finishRefresh();</span><br><span class="line">            &#125; catch (BeansException var9) &#123;</span><br><span class="line">                if (this.logger.isWarnEnabled()) &#123;</span><br><span class="line">                    this.logger.warn(&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot; + var9);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                this.destroyBeans();</span><br><span class="line">                this.cancelRefresh(var9);</span><br><span class="line">                throw var9;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                this.resetCommonCaches();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException &#123;</span><br><span class="line">    BeanWrapper instanceWrapper = null;</span><br><span class="line">    if (mbd.isSingleton()) &#123;</span><br><span class="line">        //2.创建实例</span><br><span class="line">        instanceWrapper = (BeanWrapper)this.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (instanceWrapper == null) &#123;</span><br><span class="line">        instanceWrapper = this.createBeanInstance(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object bean = instanceWrapper.getWrappedInstance();</span><br><span class="line">    Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">    if (beanType != NullBean.class) &#123;</span><br><span class="line">        mbd.resolvedTargetType = beanType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    synchronized(mbd.postProcessingLock) &#123;</span><br><span class="line">        if (!mbd.postProcessed) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                this.applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">            &#125; catch (Throwable var17) &#123;</span><br><span class="line">                throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;Post-processing of merged bean definition failed&quot;, var17);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mbd.postProcessed = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    boolean earlySingletonExposure = mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; this.isSingletonCurrentlyInCreation(beanName);</span><br><span class="line">    if (earlySingletonExposure) &#123;</span><br><span class="line">        if (this.logger.isTraceEnabled()) &#123;</span><br><span class="line">            this.logger.trace(&quot;Eagerly caching bean &#x27;&quot; + beanName + &quot;&#x27; to allow for resolving potential circular references&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.addSingletonFactory(beanName, () -&gt; &#123;</span><br><span class="line">            return this.getEarlyBeanReference(beanName, mbd, bean);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object exposedObject = bean;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        //2.属性注入，DI</span><br><span class="line">        this.populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">        //3.初始化Bean，是否实现BeanNameAware</span><br><span class="line">        exposedObject = this.initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">    &#125; catch (Throwable var18) &#123;</span><br><span class="line">        if (var18 instanceof BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException)var18).getBeanName())) &#123;</span><br><span class="line">            throw (BeanCreationException)var18;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;Initialization of bean failed&quot;, var18);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (earlySingletonExposure) &#123;</span><br><span class="line">        Object earlySingletonReference = this.getSingleton(beanName, false);</span><br><span class="line">        if (earlySingletonReference != null) &#123;</span><br><span class="line">            if (exposedObject == bean) &#123;</span><br><span class="line">                exposedObject = earlySingletonReference;</span><br><span class="line">            &#125; else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; this.hasDependentBean(beanName)) &#123;</span><br><span class="line">                String[] dependentBeans = this.getDependentBeans(beanName);</span><br><span class="line">                Set&lt;String&gt; actualDependentBeans = new LinkedHashSet(dependentBeans.length);</span><br><span class="line">                String[] var12 = dependentBeans;</span><br><span class="line">                int var13 = dependentBeans.length;</span><br><span class="line"></span><br><span class="line">                for(int var14 = 0; var14 &lt; var13; ++var14) &#123;</span><br><span class="line">                    String dependentBean = var12[var14];</span><br><span class="line">                    if (!this.removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;</span><br><span class="line">                        actualDependentBeans.add(dependentBean);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (!actualDependentBeans.isEmpty()) &#123;</span><br><span class="line">                    throw new BeanCurrentlyInCreationException(beanName, &quot;Bean with name &#x27;&quot; + beanName + &quot;&#x27; has been injected into other beans [&quot; + StringUtils.collectionToCommaDelimitedString(actualDependentBeans) + &quot;] in its raw version as part of a circular reference, but has eventually been wrapped. This means that said other beans do not use the final version of the bean. This is often the result of over-eager type matching - consider using &#x27;getBeanNamesForType&#x27; with the &#x27;allowEagerInit&#x27; flag turned off, for example.&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        this.registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br><span class="line">        return exposedObject;</span><br><span class="line">    &#125; catch (BeanDefinitionValidationException var16) &#123;</span><br><span class="line">        throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;Invalid destruction signature&quot;, var16);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) &#123;</span><br><span class="line">    if (System.getSecurityManager() != null) &#123;</span><br><span class="line">        AccessController.doPrivileged(() -&gt; &#123;</span><br><span class="line">            //3.初始化Bean，是否实现BeanNameAware</span><br><span class="line">            this.invokeAwareMethods(beanName, bean);</span><br><span class="line">            return null;</span><br><span class="line">        &#125;, this.getAccessControlContext());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this.invokeAwareMethods(beanName, bean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object wrappedBean = bean;</span><br><span class="line">    if (mbd == null || !mbd.isSynthetic()) &#123;</span><br><span class="line">       4.是否实现了BeanPostProcessor类，调用postProcessBeforeIn</span><br><span class="line">        wrappedBean = this.applyBeanPostProcessorsBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        //5.初始化方法</span><br><span class="line">        this.invokeInitMethods(beanName, wrappedBean, mbd);</span><br><span class="line">    &#125; catch (Throwable var6) &#123;</span><br><span class="line">        throw new BeanCreationException(mbd != null ? mbd.getResourceDescription() : null, beanName, &quot;Invocation of init method failed&quot;, var6);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (mbd == null || !mbd.isSynthetic()) &#123;</span><br><span class="line">       //6.是否实现了BeanPostProcessor类，调用postProcessAfterIn。。。。AOP实现</span><br><span class="line">        wrappedBean = this.applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return wrappedBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="2-手写start组件"><a href="#2-手写start组件" class="headerlink" title="2.手写start组件"></a>2.手写start组件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication-&gt;@EnableAutoConfiguration-&gt;@Import(&#123;AutoConfigurationImportSelector.class&#125;)-&gt;DeferredImportSelector-&gt;ImportSelector-&gt;selectImports-&gt;this.getAutoConfigurationEntry-&gt;this.getCandidateConfigurations-&gt; SpringFactoriesLoader.loadFactoryNames-&gt;loadSpringFactories-&gt;classLoader.getResources(&quot;META-INF/spring.factories&quot;)</span><br></pre></td></tr></table></figure>

<p>META-INF/spring</p>
<p><img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210824013535315.png" alt="image-20210824013535315"></p>
<p>1.写一个自动装配的类</p>
<p>PersonTest</p>
<p>2.META-INF/spring.factories 添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.example.start001.start.PersonTest</span><br></pre></td></tr></table></figure>

<p>3.pom文件里面build删除，防止maven冲突</p>
<p>4.clean,package,install</p>
<p>5.其他项目引入当前项目生产的maven包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;groupId&gt;com.example.start001&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;start&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/08/23/Nacos应用/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yorkiiz" target="_blank" itemprop="author">yorkiiz</a>
		
  <p class="article-time">
    <time datetime="2021-08-22T16:43:43.340Z" itemprop="datePublished"> Published 2021-08-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Nacos应用"><a href="#Nacos应用" class="headerlink" title="Nacos应用"></a>Nacos应用</h3><h4 id="nacos的基本应用"><a href="#nacos的基本应用" class="headerlink" title="nacos的基本应用"></a>nacos的基本应用</h4><p>统一配置管理，服务注册与发现</p>
<p>服务注册中心如下图</p>
<p><img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210822145229484.png" alt="image-20210822145229484"></p>
<h4 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h4><p>下载nacos的安装包后，直接解压打开startup.cmd -m standalone（下载路径<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1186nmlqPGows9gUZKAx8Zw#list/path=%2F%EF%BC%8C%E5%AF%86%E7%A0%81%EF%BC%9Areset%EF%BC%89">https://pan.baidu.com/s/1186nmlqPGows9gUZKAx8Zw#list/path=%2F，密码：reset）</a></p>
<p>安装方法与tomcat安装类似，直接解压即可使用</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8848/nacos/">http://localhost:8848/nacos/</a></p>
<p>spring boot集成nacos</p>
<p>配置中心</p>
<p>nacos的整体架构</p>
<p>nacos集群</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next&lt;span&gt;&lt;&#x2F;span&gt;</a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m yorkiiz in github. <br/>
			天道酬勤.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021 
		
		<a href="/about" target="_blank" title="yorkiiz">yorkiiz</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
